<!doctype html><html lang="en"><head><link rel="stylesheet" href="main.css"><meta charset="utf-8"><link rel="shortcut icon" href="/beacon/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="theme-color" content="#000000"><link rel="manifest" href="/beacon/manifest.json"><title>React App</title><script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script><script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script><script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script><script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script><script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script><link href="/beacon/static/css/main.20edbc45.chunk.css" rel="stylesheet"></head><body onload="" style="margin:40px;background:#6ec2c4"><div id="root"></div><h1 class="title">Beacon</h1><h2 class="subtitle">Meet Up With A Purpose</h2><div id="background" style="position:relative;margin-top:80px;margin-left:0;float:left;background-color:#d56f3e;height:460px;width:23%;border-radius:20px"><div style="float:left;margin-left:0;margin-top:4px"><br><img id="nameCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity:0"><br><br><img id="emailCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity:0"><br><br><img id="occasionCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity:0"><br><br><img id="timeCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity:0"><br><br><img id="dropCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity:0"></div><div id="userInput" style="font-size:20px;margin-left:40px;margin-top:20px"><div id="inputBoxes"><form>Name:<br><input id="name" style="height:20px"><br><br>Email:<br><input id="email" style="height:20px"><br><br>Occasion:<br><input id="occasion" style="height:20px"><br><br>Time:<br><input id="time" style="height:20px"><br><br><select id="myDropdown" class="dropdown-content"><option value="Hangout" id="hangout">Hangout</option><option value="Sport" id="sport">Sport</option><option value="Event" id="event">Event</option></select><br><br><div><button type="button" class="pinme" onclick="fillCheck()">Pin me!</button><script>function fillCheck(){0===document.getElementById("name").value.length&&(document.getElementById("nameCheck").style.opacity="1.0"),0===document.getElementById("email").value.length&&(document.getElementById("emailCheck").style.opacity="1.0"),0===document.getElementById("occasion").value.length&&(document.getElementById("occasionCheck").style.opacity="1.0"),0===document.getElementById("time").value.length&&(document.getElementById("timeCheck").style.opacity="1.0"),0===document.getElementById("hangout").value.length?document.getElementById("dropCheck").style.opacity="1.0":0===document.getElementById("sport").value.length?document.getElementById("dropCheck").style.opacity="1.0":0===document.getElementById("event").value.length&&(document.getElementById("dropCheck").style.opacity="1.0")}function unfill(){document.getElementById("nameCheck").style.opacity="0",document.getElementById("emailCheck").style.opacity="0",document.getElementById("occasionCheck").style.opacity="0",document.getElementById("timeCheck").style.opacity="0",document.getElementById("dropCheck").style.opacity="0"}</script></div><script>window.onclick=function(t){if(!t.target.matches(".dropbtn")){var n,o=document.getElementsByClassName("dropdown-content");for(n=0;n<o.length;n++){var s=o[n];s.classList.contains("show")&&s.classList.remove("show")}}}</script></form></div></div></div><div id="map" style="position:relative;float:right;padding-right:50px;width:60%;height:600px"/><script type="text/javascript">/**
        * Moves the map to display over Berlin
        *
        * @param  {H.Map} map      A HERE Map instance within the application
        */
        function moveMapToBerlin(map){

            map.setCenter({lat:32.8801, lng:-117.2340});
            map.setZoom(14);
            refreshBeacons(map);
        }

        function refreshBeacons(map) {
          console.log("running");
          var values;
          var old_beacons;
          var oldies = function(old_beacons) {
            values = old_beacons;
            refresh(values);
          }


          getOldJSON(oldies);


          function getOldJSON(callback2) {
            let req3 = new XMLHttpRequest();
            req3['responseType'] = "text";
            req3.open("GET", "https://api.jsonbin.io/b/5bc2f24b716f9364f8c37e6c/latest", true);
            req3.setRequestHeader("secret-key", "$2a$10$aXtCIwATAuWL.aDyqGE7T.H1wbu7giYVFtaPvtT6B/srWOafZgX1W");
            req3.send();

            req3.onreadystatechange = () => {
              if (req3.readyState == XMLHttpRequest.DONE) {
                console.log(req3.responseText);
                old_beacons = req3.responseText;
                callback2(old_beacons);
              }
            };
          }

          var refresh = function(data) {
            data = JSON.parse(data);
            count = data['beacons'].length;
            console.log(count);
            console.log("entering loop");
            for (var i = 0; i < count; i++) {
              console.log("looping");
              addDomMarker(map, data['beacons'][i].lat, data['beacons'][i].lon, data['beacons'][i].name, data['beacons'][i].email, data['beacons'][i].occ, data['beacons'][i].time, true);
            }
          }
        }

        function setUpClickListener(map) {
        // Attach an event listener to map display
        // obtain the coordinates and display in an alert box.
        map.addEventListener('tap', function (evt) {
        var coord = map.screenToGeo(evt.currentPointer.viewportX,
            evt.currentPointer.viewportY);
        //alert('Clicked at ' + Math.abs(coord.lat.toFixed(4)) +
        //((coord.lat > 0) ? 'N' : 'S') +
        //' ' + Math.abs(coord.lng.toFixed(4)) +
         //((coord.lng > 0) ? 'E' : 'W'));
         addDomMarker(map, coord.lat.toFixed(4), coord.lng.toFixed(4));



        });

        }


        function addDomMarker(map, lati, lon, name, email, occ, time, inJSON) {
            var outerElement = document.createElement('div'),
            innerElement = document.createElement('div');

            outerElement.style.userSelect = 'none';
            outerElement.style.webkitUserSelect = 'none';
            outerElement.style.msUserSelect = 'none';
            outerElement.style.mozUserSelect = 'none';
            outerElement.style.cursor = 'default';

            innerElement.style.color = 'red';
            innerElement.style.backgroundColor = 'blue';
            innerElement.style.border = '2px solid black';
            innerElement.style.font = 'normal 12px arial';
            innerElement.style.lineHeight = '12px'

            innerElement.style.paddingTop = '2px';
            innerElement.style.paddingLeft = '4px';
            innerElement.style.width = '20px';
            innerElement.style.height = '20px';

            // add negative margin to inner element
            // to move the anchor to center of the div
            innerElement.style.marginTop = '-10px';
            innerElement.style.marginLeft = '-10px';

            outerElement.appendChild(innerElement);

            // Add text to the DOM element
            innerElement.innerHTML = 'C';

            function alertme() {
              alert("AHH");
            }

            function changeOpacity(evt) {
                evt.target.style.opacity = 0.6;
                alert(name + " is having an event at " + time + ".\n" + "Head over and check out the " + occ + ". Their email is " + email + ".");
            };


            function changeOpacityToOne(evt) {
                evt.target.style.opacity = 1;
            };

            //create dom icon and add/remove opacity listeners
            var domIcon = new H.map.DomIcon(outerElement, {
            // the function is called every time marker enters the viewport
            onAttach: function(clonedElement, domIcon, domMarker) {
                clonedElement.addEventListener('mouseover', changeOpacity, alertme);
                clonedElement.addEventListener('mouseout', changeOpacityToOne);

            },
            // the function is called every time marker leaves the viewport
            onDetach: function(clonedElement, domIcon, domMarker) {
            clonedElement.removeEventListener('mouseover', changeOpacity);
            clonedElement.removeEventListener('mouseout', changeOpacityToOne);
            }
            });



            if (inJSON) {
              var newMarker = new H.map.DomMarker({lat:lati, lng:lon},{
                icon: domIcon
              });
              map.addObject(newMarker);
            } else {


            var name = document.getElementById("name").value;
            var email = document.getElementById("email").value;
            var occ = document.getElementById("occasion").value;
            var time = document.getElementById("time").value;

            if (name !== "" && email !== "" && occ !== "" && time !== "") {

            var newMarker = new H.map.DomMarker({lat:lati, lng:lon},{
                icon: domIcon
            });


            // //api.jsonbin.io/b/5bc2f24b716f9364f8c37e6c
            // $2a$10$aXtCIwATAuWL.aDyqGE7T.H1wbu7giYVFtaPvtT6B/srWOafZgX1W

            map.addObject(newMarker);

            unfill();

            var val;
            var returned_json;
            var jsonval = function(returned_json) {
              val = returned_json;
              update(val);
            }

            getJSON(jsonval);

            function getJSON(callback) {
              let req1 = new XMLHttpRequest();
              req1['responseType'] = "text";
              req1.open("GET", "https://api.jsonbin.io/b/5bc2f24b716f9364f8c37e6c/latest", true);
              req1.setRequestHeader("secret-key", "$2a$10$aXtCIwATAuWL.aDyqGE7T.H1wbu7giYVFtaPvtT6B/srWOafZgX1W");
              req1.send();
              req1.onreadystatechange = () => {
                if (req1.readyState == XMLHttpRequest.DONE) {
                  returned_json = req1.responseText;
                  callback(returned_json);
                }
              };
            }

            var update = function(data) {
              let req2 = new XMLHttpRequest();
                req2.onreadystatechange = () => {
                  if (req2.readyState == XMLHttpRequest.DONE) {
                    console.log(req2.responseText);
                  }
                };

              data = JSON.parse(data);
              data['beacons'].push({"name": name, "email": email, "occ": occ, "time": time, "lat": lati, "lon": lon});
              data = JSON.stringify(data);

              req2.open("PUT", "https://api.jsonbin.io/b/5bc2f24b716f9364f8c37e6c", true);
              req2.setRequestHeader("Content-type", "application/json");
              req2.send(data);
              }
            }
            }

          }
        
        
        

        /**
        * Boilerplate map initialization code starts below:
        */

        //Step 1: initialize communication with the platform
        var platform = new H.service.Platform({
            app_id: 'hM6QGhSurmnxc8i69ynP',
            app_code: 'GoO9Ti5ehS-nrEQQcm-KGQ',
            useHTTPS: true
        });
        var pixelRatio = window.devicePixelRatio || 1;
        var defaultLayers = platform.createDefaultLayers({
            tileSize: pixelRatio === 1 ? 256 : 512,
            ppi: pixelRatio === 1 ? undefined : 320
        });

        //Step 2: initialize a map  - not specificing a location will give a whole world view.
        var map = new H.Map(document.getElementById('map'),
        defaultLayers.normal.map, {pixelRatio: pixelRatio});

        //Step 3: make the map interactive
        // MapEvents enables the event system
        // Behavior implements default interactions for pan/zoom (also on mobile touch environments)
        var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

        // Create the default UI components
        var ui = H.ui.UI.createDefault(map, defaultLayers);

        // Now use the map as required...
        moveMapToBerlin(map);
        setUpClickListener(map);
        addDomMarker(map);</script><script>!function(l){function e(e){for(var r,n,t=e[0],o=e[1],u=e[2],f=0,i=[];f<t.length;f++)n=t[f],c[n]&&i.push(c[n][0]),c[n]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return p.push.apply(p,u||[]),a()}function a(){for(var e,r=0;r<p.length;r++){for(var n=p[r],t=!0,o=1;o<n.length;o++){var u=n[o];0!==c[u]&&(t=!1)}t&&(p.splice(r--,1),e=f(f.s=n[0]))}return e}var n={},c={2:0},p=[];function f(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=n,f.d=function(e,r,n){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(f.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var t in r)f.d(n,t,function(e){return r[e]}.bind(null,t));return n},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,"a",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p="/beacon/";var r=window.webpackJsonp=window.webpackJsonp||[],t=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=t;a()}([])</script><script src="/beacon/static/js/1.7eae6140.chunk.js"></script><script src="/beacon/static/js/main.c0ee54d3.chunk.js"></script></body></html>