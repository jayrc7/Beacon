<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="main.css">
    <meta charset="utf-8">
    <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <!--
      manifest.json provides metadata used when your web app is added to the
      homescreen on Android. See https://developers.google.com/web/fundamentals/engage-and-retain/web-app-manifest/
    -->
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json">
    <!--
      Notice the use of %PUBLIC_URL% in the tags above.
      It will be replaced with the URL of the `public` folder during the build.
      Only files inside the `public` folder can be referenced from the HTML.
      Unlike "/favicon.ico" or "favicon.ico", "%PUBLIC_URL%/favicon.ico" will
      work correctly both with client-side routing and a non-root public URL.
      Learn how to configure a non-root public URL by running `npm run build`.
    -->
    <title>React App</title>

    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>

  </head>

  <body onload="" style="margin: 40px">
    <div id="root"> </div>

    <div id=background style=" margin-top: 80px; margin-left: 100px; auto; float: left; background-color: #FFB451; height:460px; width: 23%; border-radius: 20px">
      <div style="auto; float: left; margin-left: 10px; margin-top: 4px">
        <br>
        <img id="nameCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity: 0">
        <br><br>
        <img id="emailCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity: 0">
        <br><br>
        <img id="occasionCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity: 0">
        <br><br>
        <img id="timeCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity: 0">
        <br><br>
        <img id="dropCheck" src="http://www.collegeaisi.ge/uploads/images/009639-simple-red-glossy-icon-arrows-hand-clear-pointer-right.png" width="80" height="55" style="opacity: 0">

    </div>

      <div id="userInput" style=" font-size: 20px; margin-left: 110px; margin-top: 20px">
        <div id = "inputBoxes">
          <form>
          Name: <br>
          <input type = "text" id="name" style="height: 20px">
          <br><br>
          Email: <br>
          <input type = "text" id="email" style="height: 20px">
          <br><br>
          Occasion: <br>
          <input type = "text" id= "occasion" style="height: 20px">
          <br><br>
          Time: <br>
          <input type = "text" id= "time" style="height: 20px">
            <br><br>


<div class="dropdown" style = "margin-left: 50px">
<button type= "button" onmouseover="myFunction()" class="dropbtn" style= "background-color: #2A1ED2">Event Type</button>
  <div id="myDropdown" class="dropdown-content">
    <a href="Hangout" id="hangout">Event</a>
    <a href="Sport" id="sport">Event</a>
    <a href="Event" id="event">Event</a>
  </div>
  <br><br>
</div>


<!-- pin me button -->
<div>
  <button type="button" class="pinme" onclick="fillCheck()"> Pin me!</button>

  <script>
    function fillCheck() {
      if ( document.getElementById("name").value.length === 0 ) {
        document.getElementById("nameCheck").style.opacity="1.0";
      }
      if ( document.getElementById("email").value.length === 0) {
        document.getElementById("emailCheck").style.opacity="1.0";
      }
      if ( document.getElementById("occasion").value.length === 0) {
        document.getElementById("occasionCheck").style.opacity="1.0";
      }
      if ( document.getElementById("time").value.length === 0) {
        document.getElementById("timeCheck").style.opacity="1.0";
      }

      alert("YES");
      //Check dropdowns
      if ( document.getElementById("hangout").value.length === 0) {
        document.getElementById("dropCheck").style.opacity="1.0";
      }
      alert("NO");

      if ( document.getElementById("hangout").value.length === 0) {
        document.getElementById("dropCheck").style.opacity="1.0";
      }
      else if ( document.getElementById("sport").value.length === 0) {
        document.getElementById("dropCheck").style.opacity="1.0";
      }
      else if ( document.getElementById("event").value.length === 0) {
        document.getElementById("dropCheck").style.opacity="1.0";
      }
    }
  </script>
</div>







<script>
/* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction() {
    document.getElementById("myDropdown").classList.toggle("show");
}

// Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {

    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}
</script>
      </form>
</div>
          </div>
        </div>
    <div id="map" style=" float: right; padding-right: 100px; width: 60%; height: 600px" />

<script  type="text/javascript" charset="UTF-8" >

        /**
        * Moves the map to display over Berlin
        *
        * @param  {H.Map} map      A HERE Map instance within the application
        */
        function moveMapToBerlin(map){

            map.setCenter({lat:32.8801, lng:-117.2340});
            map.setZoom(14);
        }



        function setUpClickListener(map) {
        // Attach an event listener to map display
        // obtain the coordinates and display in an alert box.
        map.addEventListener('tap', function (evt) {
        var coord = map.screenToGeo(evt.currentPointer.viewportX,
            evt.currentPointer.viewportY);
        //alert('Clicked at ' + Math.abs(coord.lat.toFixed(4)) +
        //((coord.lat > 0) ? 'N' : 'S') +
        //' ' + Math.abs(coord.lng.toFixed(4)) +
         //((coord.lng > 0) ? 'E' : 'W'));
         addDomMarker(map, coord.lat.toFixed(4), coord.lng.toFixed(4));



        });

        }

        function addDomMarker(map, lati, lon, name, email, event, category, time) {
            var outerElement = document.createElement('div'),
            innerElement = document.createElement('div');

            outerElement.style.userSelect = 'none';
            outerElement.style.webkitUserSelect = 'none';
            outerElement.style.msUserSelect = 'none';
            outerElement.style.mozUserSelect = 'none';
            outerElement.style.cursor = 'default';

            innerElement.style.color = 'red';
            innerElement.style.backgroundColor = 'blue';
            innerElement.style.border = '2px solid black';
            innerElement.style.font = 'normal 12px arial';
            innerElement.style.lineHeight = '12px'

            innerElement.style.paddingTop = '2px';
            innerElement.style.paddingLeft = '4px';
            innerElement.style.width = '20px';
            innerElement.style.height = '20px';

            // add negative margin to inner element
            // to move the anchor to center of the div
            innerElement.style.marginTop = '-10px';
            innerElement.style.marginLeft = '-10px';

            outerElement.appendChild(innerElement);

            // Add text to the DOM element
            innerElement.innerHTML = 'C';

            function changeOpacity(evt) {
                evt.target.style.opacity = 0.6;
            };

            function changeOpacityToOne(evt) {
                evt.target.style.opacity = 1;
            };

            //create dom icon and add/remove opacity listeners
            var domIcon = new H.map.DomIcon(outerElement, {
            // the function is called every time marker enters the viewport
            onAttach: function(clonedElement, domIcon, domMarker) {
                clonedElement.addEventListener('mouseover', changeOpacity);
                clonedElement.addEventListener('mouseout', changeOpacityToOne);
            },
            // the function is called every time marker leaves the viewport
            onDetach: function(clonedElement, domIcon, domMarker) {
            clonedElement.removeEventListener('mouseover', changeOpacity);
            clonedElement.removeEventListener('mouseout', changeOpacityToOne);
            }
            });

            var name = document.getElementById("name").value;
            var event = document.getElementById("event").value;

            var name = name;
            var event = event;
            var occ = "";
            var time = "";
            var type = "";
            var lat = lati;
            var lon = lon;

            if (name !== "" && event !== "") {

            var newMarker = new H.map.DomMarker({lat:lati, lng:lon},{
                icon: domIcon
            });


            // //api.jsonbin.io/b/5bc2f24b716f9364f8c37e6c
            // $2a$10$aXtCIwATAuWL.aDyqGE7T.H1wbu7giYVFtaPvtT6B/srWOafZgX1W

            map.addObject(newMarker);



            var val;
            var returned_json;
            var jsonval = function(returned_json) {
              val = returned_json;
              update(val);
            }

            getJSON(jsonval);

            function getJSON(callback) {
              let req1 = new XMLHttpRequest();
              req1['responseType'] = "text";
              req1.open("GET", "https://api.jsonbin.io/b/5bc2f24b716f9364f8c37e6c/latest", true);
              req1.setRequestHeader("secret-key", "$2a$10$aXtCIwATAuWL.aDyqGE7T.H1wbu7giYVFtaPvtT6B/srWOafZgX1W");
              req1.send();
              req1.onreadystatechange = () => {
                if (req1.readyState == XMLHttpRequest.DONE) {
                  returned_json = req1.responseText;
                  callback(returned_json);
                }
              };
            }

            var update = function(data) {
              let req2 = new XMLHttpRequest();
                req2.onreadystatechange = () => {
                  if (req2.readyState == XMLHttpRequest.DONE) {
                    console.log(req2.responseText);
                  }
                };

              data = JSON.parse(data);
              data['beacons'].push({"name": name, "email": email, "occasion": occ, "time": time, "type": type, "lat": lati, "lon": lon});
              data = JSON.stringify(data);

              req2.open("PUT", "https://api.jsonbin.io/b/5bc2f24b716f9364f8c37e6c", true);
              req2.setRequestHeader("Content-type", "application/json");
              req2.send(data);
              }
            }
            }



        /**
        * Boilerplate map initialization code starts below:
        */

        //Step 1: initialize communication with the platform
        var platform = new H.service.Platform({
            app_id: 'hM6QGhSurmnxc8i69ynP',
            app_code: 'GoO9Ti5ehS-nrEQQcm-KGQ',
            useHTTPS: true
        });
        var pixelRatio = window.devicePixelRatio || 1;
        var defaultLayers = platform.createDefaultLayers({
            tileSize: pixelRatio === 1 ? 256 : 512,
            ppi: pixelRatio === 1 ? undefined : 320
        });

        //Step 2: initialize a map  - not specificing a location will give a whole world view.
        var map = new H.Map(document.getElementById('map'),
        defaultLayers.normal.map, {pixelRatio: pixelRatio});

        //Step 3: make the map interactive
        // MapEvents enables the event system
        // Behavior implements default interactions for pan/zoom (also on mobile touch environments)
        var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

        // Create the default UI components
        var ui = H.ui.UI.createDefault(map, defaultLayers);

        // Now use the map as required...
        moveMapToBerlin(map);
        setUpClickListener(map);
        addDomMarker(map);

        </script>
        <!-- <script>
          $.ajax({
            url: "https://pos.api.here.com/positioning/v1/locate?app_id=hM6QGhSurmnxc8i69ynP&app_code=GoO9Ti5ehS-nrEQQcm-KGQ",
            beforeSend: function(xhr) {
              xhr.setRequestHeader("Content-Type=application/json")
            },
            type: 'POST',
            dataType: 'json',
            contentType: 'application/json',
            processData: false,
            data: '{"wcdma": [{"mcc": 262, "mnc": 7, "cid": 14674663, "nmr": [{ "uarfcndl": 10786, "psc": 149}, { "uarfcndl": 10762, "psc": 211}]}]}',

            success: function(data) {
              map.setCenter({lat:data.location.lat, lng:data.location.lng});
            },
            error: function() {
              console.log("AHHH");
            }
            });
          </script> -->


  </body>
</html>
